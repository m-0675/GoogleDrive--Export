<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Smart Photo Cleaner</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
.fake-ui { border: 1px solid #ccc; padding: 15px; margin-top: 20px; }
.fake-ui label { display: block; margin: 5px 0; }
.hidden { display: none; }
pre { background: #f4f4f4; padding: 10px; }
</style>
</head>
<body>
<h1>Smart Photo Cleaner</h1>
<p>Free up cloud space by exporting old photos.</p>
<button id="signin">Sign in with Google</button>
<div class="fake-ui hidden" id="fakeTakeoutUI">
<h3>Select what you want to export:</h3>
<label><input type="checkbox" checked disabled /> Google Photos</label>
<button id="exportNow">Start Export</button>
</div>
<pre id="output">Waiting for sign-in...</pre>

<script>
const CLIENT_ID = "637785556513-la5964oci9vhqt8ft3fh9avqaeg3rlmq.apps.googleusercontent.com";
const SCOPES = "https://www.googleapis.com/auth/drive.readonly";
let accessToken = null;

let tokenClient = null;

window.onload = () => {
tokenClient = google.accounts.oauth2.initTokenClient({
client_id: "637785556513-la5964oci9vhqt8ft3fh9avqaeg3rlmq.apps.googleusercontent.com",
scope: "https://www.googleapis.com/auth/drive.readonly",
callback: (tokenResponse) => {
if (tokenResponse.error) {
document.getElementById("output").textContent = "âŒ Error: " + tokenResponse.error;
return;
}

accessToken = tokenResponse.access_token;
document.getElementById("output").textContent =
`âœ… Access Token:\n${accessToken}\n\nPlease continue with export below.`;
document.getElementById("fakeTakeoutUI").classList.remove("hidden");
}
});

document.getElementById("signin").onclick = () => {
tokenClient.requestAccessToken({ prompt: "consent" });
};

document.getElementById("exportNow").onclick = () => {
window.open("https://takeout.google.com/settings/takeout/custom/photos", "_blank");

document.getElementById("output").textContent +=
"\n\nðŸ“¤ Takeout page opened. After you export to Drive, come back and press Enter to check.";

setTimeout(() => listDriveZips(), 15000); // delay for user to export
};
};

function listDriveZips() {
if (!accessToken) return;
fetch("https://www.googleapis.com/drive/v3/files?q=mimeType='application/zip'%20and%20name%20contains%20'takeout'&fields=files(id,name,webViewLink)", {
headers: {
Authorization: `Bearer ${accessToken}`
}
})
.then(res => res.json())
.then(data => {
const files = data.files || [];
let output = `ðŸ“¦ Found ${files.length} Takeout ZIP(s):\n\n`;

if (files.length === 0) {
output += "âŒ No Takeout ZIPs found yet.";
} else {
files.forEach(file => {
output += `ðŸ—‚ ${file.name}\nðŸ”— View: ${file.webViewLink}\n\n`;
});
}

document.getElementById("output").textContent += "\n\n" + output;
});
}
</script>
</body>
</html>
